<!DOCTYPE html>
<html lang="en">
<head>
    <script type='text/javascript' src="/static/js/doc.js"></script>
    <script type='text/javascript' src="/static/js/aes.js"></script>
    <script type='text/javascript' src="/static/js/pbkdf2.js"></script>
    <script type='text/javascript' src="/static/js/sha256.js"></script>


    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="/static/ckeditor/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="/static/ckeditor/ckeditor-init.js"></script>




    <link rel="stylesheet" type="text/css" href="/static/css/doc.css">
    <meta charset="UTF-8">
    <title>New Post</title>
</head>
<body>

    {% extends 'base.html' %}
    {% block content %}

    <h1>New Post!</h1>

    {%if error %}
        <div class="alert alert-danger" role="alert">
        {{ error }}
        </div>
    {% endif %}

    <form method="POST" action="{% url 'posts:create' %}">
        {% csrf_token %}

        <input type="text" name="title" placeholder="Title" />
        <br /><br />


        {% load wysiwyg %}
        {% wysiwyg_setup %}

        <textarea id="foo" name="document"></textarea>
        <input type="hidden" name="test" id="test">
        <input type="hidden" name="key" id="key">
        <input type="hidden" name="iv" id="iv">

        {% wysiwyg_editor "foo" %}

        <br/>

        <br/><br/>
        <button class="btn btn-primary" type="submit" value="Save" onclick="encrypt()">
            <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Save
        </button>

    </form>


        <script type="text/javascript">

			function encrypt() {
			    var key = CryptoJS.enc.Base64.parse("#base64Key#");
                var iv  = CryptoJS.enc.Base64.parse("#base64IV#");

                var doc = CKEDITOR.instances["foo"].getData();
			    var encrypted = CryptoJS.AES.encrypt(doc, key,  {iv: iv});

                document.getElementById("test").value = encrypted;

                return false;
            }

            var seed = new Uint32Array(1);
			seed = window.crypto.getRandomValues(seed);
            console.log("Rand is: " + seed[0]);

            var key = CryptoJS.SHA256(seed.toString());
            console.log("key is: " + key);

            document.getElementById("key").value = key;
            document.getElementById("iv").value = seed;

        </script>

    {% endblock %}


</body>
</html>